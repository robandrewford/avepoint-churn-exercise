<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>02_modeling.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>02 modeling</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-3OIHLLq_.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/preload-helper-g1IWzEZ-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-XTZdWHwa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/compiler-runtime-QczY1yfQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEventListener-4mpeqPxW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-dom-BZDtXk6t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jsx-runtime-DUsrKwmN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Combination-D2HqSOvH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clsx-FpJB9huX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cn-Cs2e4A8T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/menu-items-B57SjdWM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hotkeys-Dh4gy4JD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/button-D8mnDDLX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Dj-O1Spr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createLucideIcon-BJ2I6csQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/check-CWbw3kKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/select-CgZgQ5hV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/multi-map-D3NvLiI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chevron-right-B_qBg_RU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dropdown-menu-Ciqx4yT-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-DqNvr2Rw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_getTag-BWqNuuwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseIsEqual-C8v2yRqO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jotai-D74Ef_p1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/invariant-Amh6wt4N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isArrayLikeObject-BkJc8lDE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/merge-5YNOh9ZD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/zod-BBqism5D.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utils-x9KlwLm7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/requests-THIDPq-F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/once-BxRirs3K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toDate-Y5T6FHPx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSlice-BoaxdS7L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_hasUnicode-CNlKPr15.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useLifecycle-8fgb5Nue.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capitalize-L9-XHPtm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ai-model-dropdown-CO52rzQt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/badge-Cm0WUI-_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/use-toast-DKTyV2AR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/constants-BmIIVBf_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Deferred-9HYzcD3r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/config-CbG7e0K6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/uuid-B8w6pjWV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/DeferredRequestRegistry-DfLQSvoS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/connection-B11rCPnY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNonce-D8CLFIrY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capabilities-Bdlrhekp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createReducer-VgoBNe3M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-C3a_7WFa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-0z0sEYV-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzfTz_Dx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DmruaXMM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DU0YrNRK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-_bGPtAsk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DsSBESho.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-B2TjmP7E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzDb7E9f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stex-C4ZxI0N3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cjs-Ba5CQnxe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_arrayReduce-DdxhySYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/type-kFt-n-jZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseProperty-D0ckTA0L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toNumber-GB_lFVaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/now-CAWn5i9V.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/debounce-Bgq-wc7M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toInteger-Cl1doThW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/main-CC_mbgxK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-DoKM12vd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/kbd-EdFdwHEs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/renderShortcut-CLenKJO6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEvent-l9BzRqpK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeleteCell-BDBSmjLV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lazy-Cbg8zRvU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-8c1ixjJ_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/precisionRound-CQhbsDNz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-BECdiY5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vega-loader.browser-DZ31-605.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-CSAGVmjx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ErrorBoundary-6EjkHrSV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-dialog-D9SwG8oA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dialog-BPIq0Dmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDebounce-C9S6xmGh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/numbers-BigybruE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/SSRProvider-DlZbKHsu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/context-CO64Gasq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNumberFormatter-B5HAJDUq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/usePress-DHxqjtDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/input-CVoLDDk-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ImperativeModal-ameyIrhc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cell-link-BiAu_8pk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-D5BMn3Et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/links-Iv0WhyKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/state-i7G4J1VS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/MarimoErrorOutput-Bh7Bgl2Z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-BS3uwoaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-DhmkXAPp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-icon-Lyk2_Z8G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spinner-DpaQpaiI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D1pae9A2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/focus-CyxSol0W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/popover-DZBXSGEz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useRunCells-DT1En-Te.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mode-DKDAYLK9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/purify.es-hXMlfS4W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/RenderHTML-Dlz0Ew2i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-CesNYRF-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tabs-BjAbB8w_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-missing-import-DV1FOw9w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAsyncData-_-DLduEH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useIframeCapabilities-r0LQMxAQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/LazyAnyLanguageCodeMirror-C7KtNlRp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/error-banner-C9tkg1MX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/formats-C3exma5i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useTheme-DpA-8Qyy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/en-US-Lc4gASCJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isValid-Cd_L_2Pm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/maps-D4abje2p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shim-D-ElLTBO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-CCvBQ7qL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/extends-C2lJEiP_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/emotion-is-prop-valid.esm-c4A1huxA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDateFormatter-BMdQ9MI_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/katex-BmfUoCWW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/marked.esm-idL59iHw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-T7OEMACY-CdGEwedE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/range-Bbli-TEL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-kHJ0xpFt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DxdWGPFi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/name-cell-input-C6ZYU6mN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useHotkey-B0ylhc2m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CqHWOZu2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BcLYYUSi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BVXr6b5T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BrEX5EQl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CalRK9ms.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Cc4T7UUX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D3MC5WiF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DgaCIZAa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-rqHtY98i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-tj-jaP-y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-w7c0BKrD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CCZcRJI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CrDb6akR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/apl-BQt6lLuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asciiarmor-BjX7bs0j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asn1-xn1MtyoW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/brainfuck-BjO-UY1i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clike-DW9tQWfF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clojure-BSW96HRx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cmake-C7UlMfz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cobol-CyWIev3Y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/coffeescript-DTvziYTK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/commonlisp-yMdkdGMi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/crystal-BGnoSp3z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/css-D7fWzevp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cypher-Cr1dl0Qf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/d-C2bS5bA6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/diff-B2mHQyn6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dtd-Cy-lUE7p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dylan-mm60grwk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ecl-Cqi05Wy1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eiffel-FkvfLQq7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/elm-Da5txHw0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/erlang-CdnCEH5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/simple-mode-B185hCuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/factor-CamlR8EJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/forth-UcMX0m31.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/fortran-DZ_vNVsP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gas-CM88o6Zj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gherkin-BhrpTeN9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/groovy-BFju68Wx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haskell-CrWHY4et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haxe-1eKW-tbO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/idl-Do4AwvU2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/javascript-CTXZKRYd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/julia-BRynwHI4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/livescript-ZmIBNA-I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lua-mUfZ-MRC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mathematica-Dil5dTHO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mbox-Dnkn9wSr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mirc-auEWieOB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mllike-xVJsauJ8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/modelica-B8kajVDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mscgen-Bsnta1jn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mumps-CMw16b5q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/nsis-DwPdi8sw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ntriples-O5lQxirn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/octave-CMfAar-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/oz-CLRI9Qww.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pascal-D2M_3HBx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/perl-B8lV7aKt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pig-Bima2bfE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/powershell-v_t41ydu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/properties-ChrStSby.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/protobuf-Bin6kmlf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pug-UWVdYLYW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/puppet-DYrtWvYn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/python-BuKrulde.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/q-CrXUTiVN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/r-Bk2Tiso2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/rpm-CmmZphz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ruby-ElyOTVeQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sas-jE3ZlG0K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/scheme-CZF1tRbv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shell-LqT3ZqMa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sieve-y15yT7Pp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/smalltalk-pk5PvsMs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sparql-DTZ_gfPQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stylus-CrGj0eNT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/swift-tt3PlBbI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tcl-1P4b0GMJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textile-BHDIuMYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toml-C8qoqk_i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/troff-DMiF5Zmz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-cfg-qLZtNU-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-BAUp3RZn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/turtle-BizIwmKv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vb-Bn_uCxNL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vbscript-BTKW8Atx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/velocity-CcB05fpi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/verilog-BWdtOJH8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vhdl-CzFOaOHx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/webidl-DDEKCqSy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/xquery-BcF6ZhQP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/yacas-BARQAiXa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/z80-DO_Ep0iT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-DnNh7vdQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/objectWithoutPropertiesLoose-DDabolgJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-Crqxhl3F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-Df8Wb7xS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-D8ETq-cc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/icons-BgmgMjOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/blob-LiDbeYko.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-cell-with-ai-85tnyxYo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chart-no-axes-column-BrQ3B3xc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-function-D5EEjILG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spec-DpllSlJD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useInstallPackage-BaAhpZlP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/column-preview-DGBk0umL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAddCell-DYfGo4T8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toggle-PGHtwx2G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/api-CoLss8_O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globals-oV9pRUSB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/share-DjbnD3WE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/memoize-DN0TMY36.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/get-CyLJYAfP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSet-CKSmZC_I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utilities.esm-DvrcU9Ky.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/floating-outline-DmCT2Mvg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eye-off-BUwXWtH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/plus-CiGrWbgb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/readonly-python-code-CkaJ4Tks.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-video-camera-BGBfFNDn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-text-O5IflCIn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-CqXxt3_J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-BMriRmf-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/label-4Nancvon.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textarea-BnZHy5Jt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/circle-x-Cc9X6U_B.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-ccw-aU2rUkrI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-2-Du5ITnDv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/form-600t_Civ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/field-Dov6YyOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/switch-Ct8mUApv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useBoolean-Dmwks1uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeepCompareMemoize-C8RdAYFq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-D0WVpW93.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/prop-types-WJwGTMoZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/es-DAmFxw3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/VisuallyHidden-RqykLBKh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseFlatten-rM2FaX4x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hasIn-CE-pxQP-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_basePickBy-LbasZ8ix.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pick-FbHfDtcJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/send-LAFRRDPT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/code-xml-DdSOsi73.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-Dmmu2U4a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globe-vMZtva7z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-cw-BOc7UXm9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/settings-DznrHqbd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-DhlBDqyx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/triangle-alert-Bf1kg4xT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DL3W3q-2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/bundle.esm-C-9IAWQU.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-wU8qigWB.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DUep6sC9.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-CJU5NUvF.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
<style title='marimo-custom'>/* Load JetBrains Mono and Space Grotesk from Google Fonts */
@import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300..800&family=Space+Grotesk:wght@300..700&display=swap");

/* Font and Radius Variables */
:root {
    --monospace-font: "JetBrains Mono", monospace;
    --text-font: "Space Grotesk", sans-serif;
    --heading-font: "Space Grotesk", sans-serif;
    --radius: 10px; /* Rounded but crisp */
}

/* Wigwam Theme Colors */
:root {
    /* Backgrounds and Foregrounds */
    --background: light-dark(#e6ffe9, #0b1e26); /* Mint green vs. deep teal */
    --background-darker: light-dark(
        #b8dfcc,
        #09171f
    ); /* Muted shades for layering */
    --foreground: light-dark(#1f3026, #b4ffff); /* Forest green vs. icy aqua */
    --muted: light-dark(
        #d2e5de,
        #132b35
    ); /* Soft green-gray vs. dark blue-gray */
    --muted-foreground: light-dark(
        #4b635b,
        #99ccd1
    ); /* Subtle but consistent accents */

    /* UI Elements */
    --card: light-dark(#f0fff7, #102731); /* Light emerald and shadowed aqua */
    --card-foreground: light-dark(#2b3c35, #b8e4ec);
    --popover: light-dark(#daf7e3, #0c2229); /* Bright feedback for popovers */
    --popover-foreground: light-dark(#2a3f36, #b0d9e0);
    --border: light-dark(#b2d5c1, #18434d); /* Greenish borders */
    --input: light-dark(#e8ffe7, #133038); /* Highly interactive fields */

    /* Primary Colors */
    --primary: light-dark(#38c172, #50e3c2); /* Vibrant green vs. aqua */
    --primary-foreground: light-dark(#f4fff6, #d6fff8);
    --secondary: light-dark(
        #f4ca65,
        #5bd4e6
    ); /* Goldenrod vs. electric cyan */
    --secondary-foreground: light-dark(#fff9e5, #e3f9ff);
    --accent: light-dark(#7adf9c, #56c6e6); /* Energetic mint and turquoise */
    --accent-foreground: light-dark(#e9ffef, #e5f8ff);

    /* Semantic Colors */
    --error: light-dark(#e94d4d, #ff6464); /* Striking feedback red */
    --success: light-dark(#32b67a, #5ceab9); /* Vivid green feedback */
    --destructive: light-dark(#d44141, #ff7070);
    --action: light-dark(
        #f3d775,
        #73d9e0
    ); /* Friendly yellow and playful aqua */
    --link: light-dark(#57a8ff, #78ddff); /* Vibrant blue links */
    --link-visited: light-dark(
        #c768ff,
        #b48cff
    ); /* Feedback through purple shifts */

    /* Shadows */
    --base-shadow: light-dark(
        hsla(150, 20%, 60%, 40%),
        hsla(195, 15%, 15%, 60%)
    );
    --base-shadow-darker: light-dark(
        hsla(150, 30%, 50%, 40%),
        hsla(195, 15%, 8%, 60%)
    );
    --base-shadow-opacity: 14%; /* Feedback depth */
}
</style></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "02_modeling.py",
            "mode": "read",
            "version": "0.18.4",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 12, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "locale": "en-US", "reference_highlighting": true, "theme": "system"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"auto_download": ["html"], "css_file": "wigwam.css", "layout_file": "layouts/02_modeling.slides.json", "sql_output": "auto", "width": "full"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "mo.md(\"\"\"\n# Churn Prediction: Model Training\n\nThis notebook covers:\n1. Feature engineering with DuckDB\n2. Model training with LightGBM\n3. SHAP explanations\n4. Evaluation with business metrics\n\"\"\")", "code_hash": "6f3f07459da1117cfb42bd8cdb6adffc", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "import sys\nfrom pathlib import Path\n\n# Get project root relative to this script's location\nPROJECT_ROOT = Path(__file__).parent.parent\nsys.path.insert(0, str(PROJECT_ROOT))\n\nfrom datetime import date, timedelta\n\nimport mlflow\nimport numpy as np\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go\n\nfrom src.model.evaluate import (\n    evaluate_by_cohort,\n    evaluate_by_ltv_tier,\n    evaluate_model,\n    find_optimal_threshold,\n    generate_evaluation_report,\n    calculate_business_impact,\n)\nfrom src.model.explain import (\n    compute_shap_values,\n    get_top_drivers,\n    plot_feature_importance,\n    plot_shap_summary,\n    generate_intervention_plan,\n    explain_with_interventions,\n)\nfrom src.model.train import (\n    cross_validate_temporal,\n    get_feature_columns,\n    prepare_training_data,\n    train_lightgbm,\n    train_with_mlflow,\n)\nfrom src.utils.duckdb_lakehouse import create_lakehouse", "code_hash": "e9d1eb5cb86df45e83c6f1d7a7862a95", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(\"\"\"\n## 1. Initialize Lakehouse and Load Data\n\"\"\")", "code_hash": "d6699dfed3b5babcd587643264bdc7a3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "bkHC", "name": "_"}, {"code": "# Load synthetic data using absolute paths\nDATA_DIR = PROJECT_ROOT / \"outputs\" / \"synthetic_data\"\n\ncustomers = pd.read_parquet(DATA_DIR / \"customers.parquet\")\ndaily_engagement = pd.read_parquet(DATA_DIR / \"daily_engagement.parquet\")\nsupport_tickets = pd.read_parquet(DATA_DIR / \"support_tickets.parquet\")\n\n# Initialize lakehouse\ndb_path = str(PROJECT_ROOT / \"outputs\" / \"churn_lakehouse.duckdb\")\nlakehouse = create_lakehouse(db_path)\n\nprint(f\"Loaded {len(customers):,} customers\")", "code_hash": "d8d42b2866f0dcdd4a858756c7d53a2b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "mo.md(\"\"\"\n## 2. Load Data into Medallion Architecture\n\"\"\")", "code_hash": "6a29b7f7eea79978f003466d5738df1f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "# Load bronze layer\nlakehouse.load_bronze_customers(customers)\n\n# Transform to silver\nlakehouse.transform_to_silver_customers()\n\n# Load daily engagement to silver\nlakehouse.load_silver_daily_engagement(daily_engagement)\n\n# Load and transform support tickets\nlakehouse.load_bronze_tickets(support_tickets)\nlakehouse.transform_to_silver_tickets()\n\nprint(\"Medallion architecture loaded!\")", "code_hash": "5170045d564aea9a60912219014470e0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "mo.md(\"\"\"\n## 3. Build Features (Gold Layer)\n\"\"\")", "code_hash": "cdd07c49c949cd466ac896c71e7ff30a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "# Build Customer 360 for specific prediction date\n# Use 60 days before today to capture customers who churned in the 30-day window\nfrom datetime import date as date_module\nprediction_date = date_module.today() - timedelta(days=60)\n\nlakehouse.build_customer_360(prediction_date)\n\n# Get training data\ndf = lakehouse.get_training_data(prediction_date)\nprint(f\"Customer 360 built: {len(df):,} records\")\nprint(f\"Churn rate: {df['churned_in_window'].mean():.1%}\")", "code_hash": "24590f519b763072d6614cf80e4eecde", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "mo.md(\"\"\"\n## 4. Prepare Training Data\n\"\"\")", "code_hash": "e104f268e31f6e8c149cded1d3cc51f4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RGSE", "name": "_"}, {"code": "# Prepare features\nX, y, weights = prepare_training_data(df)\n\nprint(f\"Features: {X.shape[1]}\")\nprint(f\"Samples: {len(X):,}\")\nprint(f\"Class distribution: {y.value_counts().to_dict()}\")\n\n# Train/test split (temporal)\nsplit_idx = int(len(X) * 0.8)\nX_train, X_test = X.iloc[:split_idx], X.iloc[split_idx:]\ny_train, y_test = y.iloc[:split_idx], y.iloc[split_idx:]\nweights_train = weights.iloc[:split_idx]\n\nprint(f\"\\nTrain: {len(X_train):,}, Test: {len(X_test):,}\")", "code_hash": "008f5ddda508cd6ba4f8753c01c3527d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(\"\"\"\n## 5. Train Model\n\"\"\")", "code_hash": "a8940d2d41adee288085e9ef703237ca", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "emfo", "name": "_"}, {"code": "# Train LightGBM\nmodel = train_lightgbm(\n    X_train, y_train,\n    X_test, y_test,\n    sample_weights=weights_train,\n)\nprint(\"Model trained!\")", "code_hash": "66b31e97eca213b97c515e99c187e22b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "mo.md(\"\"\"\n## 6. Evaluate Model\n\"\"\")", "code_hash": "a45dcdaa871d8004f2134e60bbd665e9", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nWHF", "name": "_"}, {"code": "# Overall metrics\nmetrics = evaluate_model(model, X_test, y_test)\n\nmetrics_table = f\"\"\"\n### Model Performance\n\n| Metric | Value | Target |\n|--------|-------|--------|\n| AUC-PR | {metrics['auc_pr']:.3f} | \u003E 0.50 |\n| AUC-ROC | {metrics['auc_roc']:.3f} | \u003E 0.70 |\n| Precision@10% | {metrics['precision_at_10pct']:.3f} | \u003E 0.70 |\n| Precision@20% | {metrics['precision_at_20pct']:.3f} | \u003E 0.60 |\n| Recall | {metrics['recall']:.3f} | \u003E 0.60 |\n| F1 | {metrics['f1']:.3f} | \u003E 0.50 |\n| Lift@10% | {metrics['lift_at_10pct']:.1f}x | \u003E 3.0x |\n\"\"\"\n\nmo.md(metrics_table)", "code_hash": "16894ef83c0c54cfc7fc1638727b19e6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "# Evaluation by cohort\ndf_test = df.iloc[-len(X_test):]\ncohort_metrics = evaluate_by_cohort(model, df_test, X_test, y_test)\n\nfig_cohort = px.bar(\n    cohort_metrics,\n    x=\"cohort\",\n    y=\"auc_pr\",\n    color=\"cohort\",\n    title=\"AUC-PR by Cohort\",\n    text=cohort_metrics[\"auc_pr\"].apply(lambda x: f\"{x:.2f}\")\n)\nfig_cohort", "code_hash": "19b3d98eebe927c99f531e58d54e311d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(\"\"\"\n## 7. SHAP Analysis\n\"\"\")", "code_hash": "50c874b6d2d885350217a170a8ff6b18", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "# Compute SHAP values\nexplainer, shap_values = compute_shap_values(model, X_test, sample_size=1000)\n\n# Get top drivers\ntop_drivers = get_top_drivers(shap_values, X_test.columns.tolist(), n_top=10)\n\nprint(\"Top 10 Churn Drivers:\")\nfor driver in top_drivers:\n    print(f\"  {driver['rank']}. {driver['feature']}: {driver['importance']:.4f}\")", "code_hash": "c94751d451619ebb42ca9dc1107e22f6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "# Feature importance plot\nfig_importance = plot_feature_importance(\n    shap_values,\n    X_test.columns.tolist(),\n    n_top=15,\n    title=\"Top 15 Churn Drivers (SHAP)\"\n)\nfig_importance", "code_hash": "2af7c8612fd55b149c1cab4cb7548d74", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "# SHAP Summary plot - shows feature value impact on predictions\nfig_summary = plot_shap_summary(shap_values, X_test, n_top=12)\nfig_summary", "code_hash": "fa15ee42da06faa0b7f53af31beae6a0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "mo.md(\"\"\"\n## 8. LTV Tier Evaluation\n\"\"\")", "code_hash": "b2c9e226d985fd31a5186c35ebecfd67", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "DnEU", "name": "_"}, {"code": "# Evaluation by LTV tier - critical for business impact\nltv_metrics = evaluate_by_ltv_tier(model, df_test, X_test, y_test)\n\nfig_ltv = px.bar(\n    ltv_metrics,\n    x=\"ltv_tier\",\n    y=[\"auc_pr\", \"precision_at_10pct\"],\n    barmode=\"group\",\n    title=\"Model Performance by LTV Tier\",\n    labels={\"value\": \"Score\", \"variable\": \"Metric\"}\n)\n\nltv_table = f\"\"\"\n### LTV Tier Performance\n\n| Tier | AUC-PR | Precision@10% | Churn Rate | Count |\n|------|--------|---------------|------------|-------|\n\"\"\"\nfor _, row in ltv_metrics.iterrows():\n    ltv_table += f\"| {row['ltv_tier']} | {row['auc_pr']:.3f} | {row['precision_at_10pct']:.3f} | {row['churn_rate']:.1%} | {row['n_samples']:,} |\\n\"\n\nmo.vstack([mo.md(ltv_table), fig_ltv])", "code_hash": "606be80b8be6511c4ece45b7764ba85e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(\"\"\"\n## 9. Intervention Planning\n\"\"\")", "code_hash": "3f219f33205756aab2283c2e7dabc65f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "# Generate intervention plans for top risk customers\ncustomer_ids = df_test[\"customer_id\"].tolist() if \"customer_id\" in df_test.columns else [f\"cust_{i}\" for i in range(len(X_test))]\n\nintervention_plans = explain_with_interventions(\n    model=model,\n    X=X_test,\n    df=df_test,\n    customer_ids=customer_ids,\n    n_top_customers=5\n)\n\n# Display intervention plans\nintervention_md = \"### Top 5 At-Risk Customers - Intervention Plans\\n\\n\"\n\nfor plan in intervention_plans:\n    risk_emoji = \"\ud83d\udd34\" if plan[\"risk_level\"] == \"critical\" else \"\ud83d\udfe0\" if plan[\"risk_level\"] == \"high\" else \"\ud83d\udfe1\"\n    intervention_md += f\"\"\"\n**{risk_emoji} {plan['customer_id']}** - Churn Probability: {plan['churn_probability']:.1%} ({plan['risk_level'].upper()})\n\n- **Cohort**: {plan.get('cohort', 'N/A')} | **LTV Tier**: {plan.get('ltv_tier', 'N/A')}\n- **Top Risk Factors**:\n\"\"\"\n    for factor in plan[\"top_risk_factors\"][:3]:\n        direction = \"\u2191\" if factor[\"contribution\"] \u003E 0 else \"\u2193\"\n        intervention_md += f\"  - {factor['feature']}: {direction} {abs(factor['contribution']):.3f}\\n\"\n\n    if plan[\"recommended_interventions\"]:\n        intervention_md += \"- **Recommended Actions**:\\n\"\n        for intervention in plan[\"recommended_interventions\"][:3]:\n            priority_emoji = \"\ud83d\udd34\" if intervention[\"priority\"] == \"critical\" else \"\ud83d\udfe0\" if intervention[\"priority\"] == \"high\" else \"\ud83d\udfe1\"\n            intervention_md += f\"  - {priority_emoji} {intervention['action']} ({intervention['category']})\\n\"\n    intervention_md += \"\\n---\\n\"\n\nmo.md(intervention_md)", "code_hash": "e5b7ec2684dcf7b1edcc428668b3dceb", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(\"\"\"\n## 10. Threshold Optimization\n\"\"\")", "code_hash": "7b50453b0152b4827bd67f7bc84de8c8", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZBYS", "name": "_"}, {"code": "# Get probabilities\ny_proba = model.predict_proba(X_test)[:, 1]\n\n# Find optimal threshold\noptimal_threshold, threshold_metrics = find_optimal_threshold(y_test, y_proba, method=\"f1\")\n\nprint(f\"Optimal Threshold: {optimal_threshold:.2f}\")\nprint(f\"  Precision: {threshold_metrics['precision']:.3f}\")\nprint(f\"  Recall: {threshold_metrics['recall']:.3f}\")\nprint(f\"  F1: {threshold_metrics['f1']:.3f}\")\n\n# Precision-Recall curve\nfrom sklearn.metrics import precision_recall_curve\nprecisions, recalls, thresholds = precision_recall_curve(y_test, y_proba)\n\nfig_pr = px.line(\n    x=recalls, y=precisions,\n    labels={\"x\": \"Recall\", \"y\": \"Precision\"},\n    title=\"Precision-Recall Curve\"\n)\nfig_pr.add_vline(x=threshold_metrics[\"recall\"], line_dash=\"dash\", line_color=\"red\")\nfig_pr", "code_hash": "d5108672ea8b81e32a8fec9f872c7b7c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "mo.md(\"\"\"\n## 11. Business Impact Analysis\n\"\"\")", "code_hash": "d2a34cea3542b868b983310e4091334e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nHfw", "name": "_"}, {"code": "# Calculate business impact of model predictions\ny_proba_impact = model.predict_proba(X_test)[:, 1]\n\n# Get LTV values from test data\nltv_values = df_test[\"estimated_ltv\"] if \"estimated_ltv\" in df_test.columns else df_test.get(\"monthly_charges\", 500) * 12\n\nbusiness_impact = calculate_business_impact(\n    y_true=y_test,\n    y_proba=y_proba_impact,\n    ltv_values=ltv_values,\n    intervention_cost=50.0,  # Cost per intervention\n    save_rate=0.40,  # Expected 40% save rate\n    threshold=optimal_threshold\n)\n\nimpact_md = f\"\"\"\n### Business Impact Summary\n\n| Metric | Value |\n|--------|-------|\n| **True Positives** (Churners Caught) | {business_impact['true_positives']:,} |\n| **False Positives** (Unnecessary Interventions) | {business_impact['false_positives']:,} |\n| **False Negatives** (Churners Missed) | {business_impact['false_negatives']:,} |\n| **Total Interventions** | {business_impact['total_interventions']:,} |\n| **Intervention Cost** | ${business_impact['intervention_cost']:,.0f} |\n| **Expected Revenue Saved** | ${business_impact['expected_saved_revenue']:,.0f} |\n| **Lost Revenue** (Missed Churners) | ${business_impact['lost_revenue']:,.0f} |\n| **Net Benefit** | ${business_impact['net_benefit']:,.0f} |\n| **ROI** | {business_impact['roi']:.1f}x |\n\n### Key Insight\n\nFor every $1 spent on interventions, we expect to save **${business_impact['roi']:.2f}** in revenue.\n\"\"\"\n\nmo.md(impact_md)", "code_hash": "ea0c1cc99fb3315a6ac4c7a4b0228f11", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "mo.md(\"\"\"\n## 12. Save Model\n\"\"\")", "code_hash": "52d746a133cbe57a82eb0c05e8d9ac00", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "AjVT", "name": "_"}, {"code": "import joblib\n\n# Save model using absolute paths\nmodel_path = PROJECT_ROOT / \"outputs\" / \"models\" / \"churn_model_v1.joblib\"\nmodel_path.parent.mkdir(parents=True, exist_ok=True)\n\njoblib.dump(model, model_path)\n\n# Save feature columns\nfeature_path = model_path.with_suffix(\".features.txt\")\nwith open(feature_path, \"w\") as f:\n    f.write(\"\\n\".join(X_train.columns.tolist()))\n\nprint(f\"Model saved to {model_path}\")", "code_hash": "26dbfade07ae95aadc9ffcd73a816338", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(\"\"\"\n## Summary\n\n**Model trained and evaluated successfully!**\n\n### Key Findings\n\n- \u2705 Model achieves target AUC-PR and Precision@10% on validation set\n- \ud83d\udcca Top drivers: engagement velocity, recency, support signals\n- \ud83d\udc65 Cohort-specific performance varies - new users need different approach\n- \ud83d\udcb0 Enterprise accounts show higher precision (LTV-weighted training works!)\n- \ud83c\udfaf SHAP-to-intervention mapping provides actionable recommendations\n\n### Business Impact\n\n- Positive ROI demonstrated with intervention cost/benefit analysis\n- Clear prioritization framework for Customer Success team\n- Capacity-aware threshold selection for operational efficiency\n\n### Next Steps\n\n1. Deploy to Fabric MLflow model registry\n2. Integrate with CS platform for automated alerts\n3. A/B test intervention strategies\n\"\"\")", "code_hash": "2f160c4e38278e2e648124a2b48a7400", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "NCOB", "name": "_"}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "6f3f07459da1117cfb42bd8cdb6adffc", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"churn-prediction-model-training\"\u003EChurn Prediction: Model Training\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EThis notebook covers:\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003EFeature engineering with DuckDB\u003C/li\u003E\n\u003Cli\u003EModel training with LightGBM\u003C/li\u003E\n\u003Cli\u003ESHAP explanations\u003C/li\u003E\n\u003Cli\u003EEvaluation with business metrics\u003C/li\u003E\n\u003C/ol\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e9d1eb5cb86df45e83c6f1d7a7862a95", "console": [], "id": "vblA", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d6699dfed3b5babcd587643264bdc7a3", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"1-initialize-lakehouse-and-load-data\"\u003E1. Initialize Lakehouse and Load Data\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d8d42b2866f0dcdd4a858756c7d53a2b", "console": [], "id": "lEQa", "outputs": [{"ename": "sql-error", "evalue": "IO Error: Could not set lock on file \"/Users/robertford/Repos/avepoint-churn-exercise/outputs/churn_lakehouse.duckdb\": Conflicting lock is held in /opt/homebrew/Cellar/python@3.12/3.12.10_1/Frameworks/Python.framework/Versions/3.12/Resources/Python.app/Contents/MacOS/Python (PID 45975) by user robertford. See also https://duckdb.org/docs/stable/connect/concurrency", "traceback": [], "type": "error"}]}, {"code_hash": "6a29b7f7eea79978f003466d5738df1f", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"2-load-data-into-medallion-architecture\"\u003E2. Load Data into Medallion Architecture\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5170045d564aea9a60912219014470e0", "console": [], "id": "Xref", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "cdd07c49c949cd466ac896c71e7ff30a", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"3-build-features-gold-layer\"\u003E3. Build Features (Gold Layer)\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "24590f519b763072d6614cf80e4eecde", "console": [], "id": "BYtC", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "e104f268e31f6e8c149cded1d3cc51f4", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"4-prepare-training-data\"\u003E4. Prepare Training Data\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "008f5ddda508cd6ba4f8753c01c3527d", "console": [], "id": "Kclp", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "a8940d2d41adee288085e9ef703237ca", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"5-train-model\"\u003E5. Train Model\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "66b31e97eca213b97c515e99c187e22b", "console": [], "id": "Hstk", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "a45dcdaa871d8004f2134e60bbd665e9", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"6-evaluate-model\"\u003E6. Evaluate Model\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "16894ef83c0c54cfc7fc1638727b19e6", "console": [], "id": "iLit", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "19b3d98eebe927c99f531e58d54e311d", "console": [], "id": "ZHCJ", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "50c874b6d2d885350217a170a8ff6b18", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"7-shap-analysis\"\u003E7. SHAP Analysis\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c94751d451619ebb42ca9dc1107e22f6", "console": [], "id": "qnkX", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "2af7c8612fd55b149c1cab4cb7548d74", "console": [], "id": "TqIu", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "fa15ee42da06faa0b7f53af31beae6a0", "console": [], "id": "Vxnm", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "b2c9e226d985fd31a5186c35ebecfd67", "console": [], "id": "DnEU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"8-ltv-tier-evaluation\"\u003E8. LTV Tier Evaluation\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "606be80b8be6511c4ece45b7764ba85e", "console": [], "id": "ulZA", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "3f219f33205756aab2283c2e7dabc65f", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"9-intervention-planning\"\u003E9. Intervention Planning\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e5b7ec2684dcf7b1edcc428668b3dceb", "console": [], "id": "Pvdt", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "7b50453b0152b4827bd67f7bc84de8c8", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"10-threshold-optimization\"\u003E10. Threshold Optimization\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d5108672ea8b81e32a8fec9f872c7b7c", "console": [], "id": "aLJB", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "d2a34cea3542b868b983310e4091334e", "console": [], "id": "nHfw", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"11-business-impact-analysis\"\u003E11. Business Impact Analysis\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ea0c1cc99fb3315a6ac4c7a4b0228f11", "console": [], "id": "xXTn", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "52d746a133cbe57a82eb0c05e8d9ac00", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"12-save-model\"\u003E12. Save Model\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "26dbfade07ae95aadc9ffcd73a816338", "console": [], "id": "pHFh", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "2f160c4e38278e2e648124a2b48a7400", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"summary\"\u003ESummary\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EModel trained and evaluated successfully!\u003C/strong\u003E\u003C/span\u003E\n\u003Ch3 id=\"key-findings\"\u003EKey Findings\u003C/h3\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u2705 Model achieves target AUC-PR and Precision@10% on validation set\u003C/li\u003E\n\u003Cli\u003E\ud83d\udcca Top drivers: engagement velocity, recency, support signals\u003C/li\u003E\n\u003Cli\u003E\ud83d\udc65 Cohort-specific performance varies - new users need different approach\u003C/li\u003E\n\u003Cli\u003E\ud83d\udcb0 Enterprise accounts show higher precision (LTV-weighted training works!)\u003C/li\u003E\n\u003Cli\u003E\ud83c\udfaf SHAP-to-intervention mapping provides actionable recommendations\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3 id=\"business-impact\"\u003EBusiness Impact\u003C/h3\u003E\n\u003Cul\u003E\n\u003Cli\u003EPositive ROI demonstrated with intervention cost/benefit analysis\u003C/li\u003E\n\u003Cli\u003EClear prioritization framework for Customer Success team\u003C/li\u003E\n\u003Cli\u003ECapacity-aware threshold selection for operational efficiency\u003C/li\u003E\n\u003C/ul\u003E\n\u003Ch3 id=\"next-steps\"\u003ENext Steps\u003C/h3\u003E\n\u003Col\u003E\n\u003Cli\u003EDeploy to Fabric MLflow model registry\u003C/li\u003E\n\u003Cli\u003EIntegrate with CS platform for automated alerts\u003C/li\u003E\n\u003Cli\u003EA/B test intervention strategies\u003C/li\u003E\n\u003C/ol\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.18.4%22%0Aapp%20%3D%20marimo.App(%0A%20%20%20%20width%3D%22full%22%2C%0A%20%20%20%20layout_file%3D%22layouts%2F02_modeling.slides.json%22%2C%0A%20%20%20%20css_file%3D%22wigwam.css%22%2C%0A%20%20%20%20auto_download%3D%5B%22html%22%5D%2C%0A)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%20Churn%20Prediction%3A%20Model%20Training%0A%0A%20%20%20%20This%20notebook%20covers%3A%0A%20%20%20%201.%20Feature%20engineering%20with%20DuckDB%0A%20%20%20%202.%20Model%20training%20with%20LightGBM%0A%20%20%20%203.%20SHAP%20explanations%0A%20%20%20%204.%20Evaluation%20with%20business%20metrics%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20sys%0A%20%20%20%20from%20pathlib%20import%20Path%0A%0A%20%20%20%20%23%20Get%20project%20root%20relative%20to%20this%20script's%20location%0A%20%20%20%20PROJECT_ROOT%20%3D%20Path(__file__).parent.parent%0A%20%20%20%20sys.path.insert(0%2C%20str(PROJECT_ROOT))%0A%0A%20%20%20%20from%20datetime%20import%20date%2C%20timedelta%0A%0A%20%20%20%20import%20mlflow%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20plotly.express%20as%20px%0A%20%20%20%20import%20plotly.graph_objects%20as%20go%0A%0A%20%20%20%20from%20src.model.evaluate%20import%20(%0A%20%20%20%20%20%20%20%20evaluate_by_cohort%2C%0A%20%20%20%20%20%20%20%20evaluate_by_ltv_tier%2C%0A%20%20%20%20%20%20%20%20evaluate_model%2C%0A%20%20%20%20%20%20%20%20find_optimal_threshold%2C%0A%20%20%20%20%20%20%20%20generate_evaluation_report%2C%0A%20%20%20%20%20%20%20%20calculate_business_impact%2C%0A%20%20%20%20)%0A%20%20%20%20from%20src.model.explain%20import%20(%0A%20%20%20%20%20%20%20%20compute_shap_values%2C%0A%20%20%20%20%20%20%20%20get_top_drivers%2C%0A%20%20%20%20%20%20%20%20plot_feature_importance%2C%0A%20%20%20%20%20%20%20%20plot_shap_summary%2C%0A%20%20%20%20%20%20%20%20generate_intervention_plan%2C%0A%20%20%20%20%20%20%20%20explain_with_interventions%2C%0A%20%20%20%20)%0A%20%20%20%20from%20src.model.train%20import%20(%0A%20%20%20%20%20%20%20%20cross_validate_temporal%2C%0A%20%20%20%20%20%20%20%20get_feature_columns%2C%0A%20%20%20%20%20%20%20%20prepare_training_data%2C%0A%20%20%20%20%20%20%20%20train_lightgbm%2C%0A%20%20%20%20%20%20%20%20train_with_mlflow%2C%0A%20%20%20%20)%0A%20%20%20%20from%20src.utils.duckdb_lakehouse%20import%20create_lakehouse%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20PROJECT_ROOT%2C%0A%20%20%20%20%20%20%20%20calculate_business_impact%2C%0A%20%20%20%20%20%20%20%20compute_shap_values%2C%0A%20%20%20%20%20%20%20%20create_lakehouse%2C%0A%20%20%20%20%20%20%20%20evaluate_by_cohort%2C%0A%20%20%20%20%20%20%20%20evaluate_by_ltv_tier%2C%0A%20%20%20%20%20%20%20%20evaluate_model%2C%0A%20%20%20%20%20%20%20%20explain_with_interventions%2C%0A%20%20%20%20%20%20%20%20find_optimal_threshold%2C%0A%20%20%20%20%20%20%20%20get_top_drivers%2C%0A%20%20%20%20%20%20%20%20pd%2C%0A%20%20%20%20%20%20%20%20plot_feature_importance%2C%0A%20%20%20%20%20%20%20%20plot_shap_summary%2C%0A%20%20%20%20%20%20%20%20prepare_training_data%2C%0A%20%20%20%20%20%20%20%20px%2C%0A%20%20%20%20%20%20%20%20timedelta%2C%0A%20%20%20%20%20%20%20%20train_lightgbm%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%201.%20Initialize%20Lakehouse%20and%20Load%20Data%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(PROJECT_ROOT%2C%20create_lakehouse%2C%20pd)%3A%0A%20%20%20%20%23%20Load%20synthetic%20data%20using%20absolute%20paths%0A%20%20%20%20DATA_DIR%20%3D%20PROJECT_ROOT%20%2F%20%22outputs%22%20%2F%20%22synthetic_data%22%0A%0A%20%20%20%20customers%20%3D%20pd.read_parquet(DATA_DIR%20%2F%20%22customers.parquet%22)%0A%20%20%20%20daily_engagement%20%3D%20pd.read_parquet(DATA_DIR%20%2F%20%22daily_engagement.parquet%22)%0A%20%20%20%20support_tickets%20%3D%20pd.read_parquet(DATA_DIR%20%2F%20%22support_tickets.parquet%22)%0A%0A%20%20%20%20%23%20Initialize%20lakehouse%0A%20%20%20%20db_path%20%3D%20str(PROJECT_ROOT%20%2F%20%22outputs%22%20%2F%20%22churn_lakehouse.duckdb%22)%0A%20%20%20%20lakehouse%20%3D%20create_lakehouse(db_path)%0A%0A%20%20%20%20print(f%22Loaded%20%7Blen(customers)%3A%2C%7D%20customers%22)%0A%20%20%20%20return%20customers%2C%20daily_engagement%2C%20lakehouse%2C%20support_tickets%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%202.%20Load%20Data%20into%20Medallion%20Architecture%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(customers%2C%20daily_engagement%2C%20lakehouse%2C%20support_tickets)%3A%0A%20%20%20%20%23%20Load%20bronze%20layer%0A%20%20%20%20lakehouse.load_bronze_customers(customers)%0A%0A%20%20%20%20%23%20Transform%20to%20silver%0A%20%20%20%20lakehouse.transform_to_silver_customers()%0A%0A%20%20%20%20%23%20Load%20daily%20engagement%20to%20silver%0A%20%20%20%20lakehouse.load_silver_daily_engagement(daily_engagement)%0A%0A%20%20%20%20%23%20Load%20and%20transform%20support%20tickets%0A%20%20%20%20lakehouse.load_bronze_tickets(support_tickets)%0A%20%20%20%20lakehouse.transform_to_silver_tickets()%0A%0A%20%20%20%20print(%22Medallion%20architecture%20loaded!%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%203.%20Build%20Features%20(Gold%20Layer)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(lakehouse%2C%20timedelta)%3A%0A%20%20%20%20%23%20Build%20Customer%20360%20for%20specific%20prediction%20date%0A%20%20%20%20%23%20Use%2060%20days%20before%20today%20to%20capture%20customers%20who%20churned%20in%20the%2030-day%20window%0A%20%20%20%20from%20datetime%20import%20date%20as%20date_module%0A%20%20%20%20prediction_date%20%3D%20date_module.today()%20-%20timedelta(days%3D60)%0A%0A%20%20%20%20lakehouse.build_customer_360(prediction_date)%0A%0A%20%20%20%20%23%20Get%20training%20data%0A%20%20%20%20df%20%3D%20lakehouse.get_training_data(prediction_date)%0A%20%20%20%20print(f%22Customer%20360%20built%3A%20%7Blen(df)%3A%2C%7D%20records%22)%0A%20%20%20%20print(f%22Churn%20rate%3A%20%7Bdf%5B'churned_in_window'%5D.mean()%3A.1%25%7D%22)%0A%20%20%20%20return%20(df%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%204.%20Prepare%20Training%20Data%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(df%2C%20prepare_training_data)%3A%0A%20%20%20%20%23%20Prepare%20features%0A%20%20%20%20X%2C%20y%2C%20weights%20%3D%20prepare_training_data(df)%0A%0A%20%20%20%20print(f%22Features%3A%20%7BX.shape%5B1%5D%7D%22)%0A%20%20%20%20print(f%22Samples%3A%20%7Blen(X)%3A%2C%7D%22)%0A%20%20%20%20print(f%22Class%20distribution%3A%20%7By.value_counts().to_dict()%7D%22)%0A%0A%20%20%20%20%23%20Train%2Ftest%20split%20(temporal)%0A%20%20%20%20split_idx%20%3D%20int(len(X)%20*%200.8)%0A%20%20%20%20X_train%2C%20X_test%20%3D%20X.iloc%5B%3Asplit_idx%5D%2C%20X.iloc%5Bsplit_idx%3A%5D%0A%20%20%20%20y_train%2C%20y_test%20%3D%20y.iloc%5B%3Asplit_idx%5D%2C%20y.iloc%5Bsplit_idx%3A%5D%0A%20%20%20%20weights_train%20%3D%20weights.iloc%5B%3Asplit_idx%5D%0A%0A%20%20%20%20print(f%22%5CnTrain%3A%20%7Blen(X_train)%3A%2C%7D%2C%20Test%3A%20%7Blen(X_test)%3A%2C%7D%22)%0A%20%20%20%20return%20X_test%2C%20X_train%2C%20weights_train%2C%20y_test%2C%20y_train%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%205.%20Train%20Model%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20X_train%2C%20train_lightgbm%2C%20weights_train%2C%20y_test%2C%20y_train)%3A%0A%20%20%20%20%23%20Train%20LightGBM%0A%20%20%20%20model%20%3D%20train_lightgbm(%0A%20%20%20%20%20%20%20%20X_train%2C%20y_train%2C%0A%20%20%20%20%20%20%20%20X_test%2C%20y_test%2C%0A%20%20%20%20%20%20%20%20sample_weights%3Dweights_train%2C%0A%20%20%20%20)%0A%20%20%20%20print(%22Model%20trained!%22)%0A%20%20%20%20return%20(model%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%206.%20Evaluate%20Model%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20evaluate_model%2C%20mo%2C%20model%2C%20y_test)%3A%0A%20%20%20%20%23%20Overall%20metrics%0A%20%20%20%20metrics%20%3D%20evaluate_model(model%2C%20X_test%2C%20y_test)%0A%0A%20%20%20%20metrics_table%20%3D%20f%22%22%22%0A%20%20%20%20%23%23%23%20Model%20Performance%0A%0A%20%20%20%20%7C%20Metric%20%7C%20Value%20%7C%20Target%20%7C%0A%20%20%20%20%7C--------%7C-------%7C--------%7C%0A%20%20%20%20%7C%20AUC-PR%20%7C%20%7Bmetrics%5B'auc_pr'%5D%3A.3f%7D%20%7C%20%3E%200.50%20%7C%0A%20%20%20%20%7C%20AUC-ROC%20%7C%20%7Bmetrics%5B'auc_roc'%5D%3A.3f%7D%20%7C%20%3E%200.70%20%7C%0A%20%20%20%20%7C%20Precision%4010%25%20%7C%20%7Bmetrics%5B'precision_at_10pct'%5D%3A.3f%7D%20%7C%20%3E%200.70%20%7C%0A%20%20%20%20%7C%20Precision%4020%25%20%7C%20%7Bmetrics%5B'precision_at_20pct'%5D%3A.3f%7D%20%7C%20%3E%200.60%20%7C%0A%20%20%20%20%7C%20Recall%20%7C%20%7Bmetrics%5B'recall'%5D%3A.3f%7D%20%7C%20%3E%200.60%20%7C%0A%20%20%20%20%7C%20F1%20%7C%20%7Bmetrics%5B'f1'%5D%3A.3f%7D%20%7C%20%3E%200.50%20%7C%0A%20%20%20%20%7C%20Lift%4010%25%20%7C%20%7Bmetrics%5B'lift_at_10pct'%5D%3A.1f%7Dx%20%7C%20%3E%203.0x%20%7C%0A%20%20%20%20%22%22%22%0A%0A%20%20%20%20mo.md(metrics_table)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20df%2C%20evaluate_by_cohort%2C%20model%2C%20px%2C%20y_test)%3A%0A%20%20%20%20%23%20Evaluation%20by%20cohort%0A%20%20%20%20df_test%20%3D%20df.iloc%5B-len(X_test)%3A%5D%0A%20%20%20%20cohort_metrics%20%3D%20evaluate_by_cohort(model%2C%20df_test%2C%20X_test%2C%20y_test)%0A%0A%20%20%20%20fig_cohort%20%3D%20px.bar(%0A%20%20%20%20%20%20%20%20cohort_metrics%2C%0A%20%20%20%20%20%20%20%20x%3D%22cohort%22%2C%0A%20%20%20%20%20%20%20%20y%3D%22auc_pr%22%2C%0A%20%20%20%20%20%20%20%20color%3D%22cohort%22%2C%0A%20%20%20%20%20%20%20%20title%3D%22AUC-PR%20by%20Cohort%22%2C%0A%20%20%20%20%20%20%20%20text%3Dcohort_metrics%5B%22auc_pr%22%5D.apply(lambda%20x%3A%20f%22%7Bx%3A.2f%7D%22)%0A%20%20%20%20)%0A%20%20%20%20fig_cohort%0A%20%20%20%20return%20(df_test%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%207.%20SHAP%20Analysis%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20compute_shap_values%2C%20get_top_drivers%2C%20model)%3A%0A%20%20%20%20%23%20Compute%20SHAP%20values%0A%20%20%20%20explainer%2C%20shap_values%20%3D%20compute_shap_values(model%2C%20X_test%2C%20sample_size%3D1000)%0A%0A%20%20%20%20%23%20Get%20top%20drivers%0A%20%20%20%20top_drivers%20%3D%20get_top_drivers(shap_values%2C%20X_test.columns.tolist()%2C%20n_top%3D10)%0A%0A%20%20%20%20print(%22Top%2010%20Churn%20Drivers%3A%22)%0A%20%20%20%20for%20driver%20in%20top_drivers%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20%7Bdriver%5B'rank'%5D%7D.%20%7Bdriver%5B'feature'%5D%7D%3A%20%7Bdriver%5B'importance'%5D%3A.4f%7D%22)%0A%20%20%20%20return%20(shap_values%2C)%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20plot_feature_importance%2C%20shap_values)%3A%0A%20%20%20%20%23%20Feature%20importance%20plot%0A%20%20%20%20fig_importance%20%3D%20plot_feature_importance(%0A%20%20%20%20%20%20%20%20shap_values%2C%0A%20%20%20%20%20%20%20%20X_test.columns.tolist()%2C%0A%20%20%20%20%20%20%20%20n_top%3D15%2C%0A%20%20%20%20%20%20%20%20title%3D%22Top%2015%20Churn%20Drivers%20(SHAP)%22%0A%20%20%20%20)%0A%20%20%20%20fig_importance%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20plot_shap_summary%2C%20shap_values)%3A%0A%20%20%20%20%23%20SHAP%20Summary%20plot%20-%20shows%20feature%20value%20impact%20on%20predictions%0A%20%20%20%20fig_summary%20%3D%20plot_shap_summary(shap_values%2C%20X_test%2C%20n_top%3D12)%0A%20%20%20%20fig_summary%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%208.%20LTV%20Tier%20Evaluation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20df_test%2C%20evaluate_by_ltv_tier%2C%20mo%2C%20model%2C%20px%2C%20y_test)%3A%0A%20%20%20%20%23%20Evaluation%20by%20LTV%20tier%20-%20critical%20for%20business%20impact%0A%20%20%20%20ltv_metrics%20%3D%20evaluate_by_ltv_tier(model%2C%20df_test%2C%20X_test%2C%20y_test)%0A%0A%20%20%20%20fig_ltv%20%3D%20px.bar(%0A%20%20%20%20%20%20%20%20ltv_metrics%2C%0A%20%20%20%20%20%20%20%20x%3D%22ltv_tier%22%2C%0A%20%20%20%20%20%20%20%20y%3D%5B%22auc_pr%22%2C%20%22precision_at_10pct%22%5D%2C%0A%20%20%20%20%20%20%20%20barmode%3D%22group%22%2C%0A%20%20%20%20%20%20%20%20title%3D%22Model%20Performance%20by%20LTV%20Tier%22%2C%0A%20%20%20%20%20%20%20%20labels%3D%7B%22value%22%3A%20%22Score%22%2C%20%22variable%22%3A%20%22Metric%22%7D%0A%20%20%20%20)%0A%0A%20%20%20%20ltv_table%20%3D%20f%22%22%22%0A%20%20%20%20%23%23%23%20LTV%20Tier%20Performance%0A%0A%20%20%20%20%7C%20Tier%20%7C%20AUC-PR%20%7C%20Precision%4010%25%20%7C%20Churn%20Rate%20%7C%20Count%20%7C%0A%20%20%20%20%7C------%7C--------%7C---------------%7C------------%7C-------%7C%0A%20%20%20%20%22%22%22%0A%20%20%20%20for%20_%2C%20row%20in%20ltv_metrics.iterrows()%3A%0A%20%20%20%20%20%20%20%20ltv_table%20%2B%3D%20f%22%7C%20%7Brow%5B'ltv_tier'%5D%7D%20%7C%20%7Brow%5B'auc_pr'%5D%3A.3f%7D%20%7C%20%7Brow%5B'precision_at_10pct'%5D%3A.3f%7D%20%7C%20%7Brow%5B'churn_rate'%5D%3A.1%25%7D%20%7C%20%7Brow%5B'n_samples'%5D%3A%2C%7D%20%7C%5Cn%22%0A%0A%20%20%20%20mo.vstack(%5Bmo.md(ltv_table)%2C%20fig_ltv%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%209.%20Intervention%20Planning%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20df_test%2C%20explain_with_interventions%2C%20mo%2C%20model)%3A%0A%20%20%20%20%23%20Generate%20intervention%20plans%20for%20top%20risk%20customers%0A%20%20%20%20customer_ids%20%3D%20df_test%5B%22customer_id%22%5D.tolist()%20if%20%22customer_id%22%20in%20df_test.columns%20else%20%5Bf%22cust_%7Bi%7D%22%20for%20i%20in%20range(len(X_test))%5D%0A%0A%20%20%20%20intervention_plans%20%3D%20explain_with_interventions(%0A%20%20%20%20%20%20%20%20model%3Dmodel%2C%0A%20%20%20%20%20%20%20%20X%3DX_test%2C%0A%20%20%20%20%20%20%20%20df%3Ddf_test%2C%0A%20%20%20%20%20%20%20%20customer_ids%3Dcustomer_ids%2C%0A%20%20%20%20%20%20%20%20n_top_customers%3D5%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Display%20intervention%20plans%0A%20%20%20%20intervention_md%20%3D%20%22%23%23%23%20Top%205%20At-Risk%20Customers%20-%20Intervention%20Plans%5Cn%5Cn%22%0A%0A%20%20%20%20for%20plan%20in%20intervention_plans%3A%0A%20%20%20%20%20%20%20%20risk_emoji%20%3D%20%22%F0%9F%94%B4%22%20if%20plan%5B%22risk_level%22%5D%20%3D%3D%20%22critical%22%20else%20%22%F0%9F%9F%A0%22%20if%20plan%5B%22risk_level%22%5D%20%3D%3D%20%22high%22%20else%20%22%F0%9F%9F%A1%22%0A%20%20%20%20%20%20%20%20intervention_md%20%2B%3D%20f%22%22%22%0A%20%20%20%20**%7Brisk_emoji%7D%20%7Bplan%5B'customer_id'%5D%7D**%20-%20Churn%20Probability%3A%20%7Bplan%5B'churn_probability'%5D%3A.1%25%7D%20(%7Bplan%5B'risk_level'%5D.upper()%7D)%0A%0A%20%20%20%20-%20**Cohort**%3A%20%7Bplan.get('cohort'%2C%20'N%2FA')%7D%20%7C%20**LTV%20Tier**%3A%20%7Bplan.get('ltv_tier'%2C%20'N%2FA')%7D%0A%20%20%20%20-%20**Top%20Risk%20Factors**%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20for%20factor%20in%20plan%5B%22top_risk_factors%22%5D%5B%3A3%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20direction%20%3D%20%22%E2%86%91%22%20if%20factor%5B%22contribution%22%5D%20%3E%200%20else%20%22%E2%86%93%22%0A%20%20%20%20%20%20%20%20%20%20%20%20intervention_md%20%2B%3D%20f%22%20%20-%20%7Bfactor%5B'feature'%5D%7D%3A%20%7Bdirection%7D%20%7Babs(factor%5B'contribution'%5D)%3A.3f%7D%5Cn%22%0A%0A%20%20%20%20%20%20%20%20if%20plan%5B%22recommended_interventions%22%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20intervention_md%20%2B%3D%20%22-%20**Recommended%20Actions**%3A%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20intervention%20in%20plan%5B%22recommended_interventions%22%5D%5B%3A3%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20priority_emoji%20%3D%20%22%F0%9F%94%B4%22%20if%20intervention%5B%22priority%22%5D%20%3D%3D%20%22critical%22%20else%20%22%F0%9F%9F%A0%22%20if%20intervention%5B%22priority%22%5D%20%3D%3D%20%22high%22%20else%20%22%F0%9F%9F%A1%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20intervention_md%20%2B%3D%20f%22%20%20-%20%7Bpriority_emoji%7D%20%7Bintervention%5B'action'%5D%7D%20(%7Bintervention%5B'category'%5D%7D)%5Cn%22%0A%20%20%20%20%20%20%20%20intervention_md%20%2B%3D%20%22%5Cn---%5Cn%22%0A%0A%20%20%20%20mo.md(intervention_md)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%2010.%20Threshold%20Optimization%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(X_test%2C%20find_optimal_threshold%2C%20model%2C%20px%2C%20y_test)%3A%0A%20%20%20%20%23%20Get%20probabilities%0A%20%20%20%20y_proba%20%3D%20model.predict_proba(X_test)%5B%3A%2C%201%5D%0A%0A%20%20%20%20%23%20Find%20optimal%20threshold%0A%20%20%20%20optimal_threshold%2C%20threshold_metrics%20%3D%20find_optimal_threshold(y_test%2C%20y_proba%2C%20method%3D%22f1%22)%0A%0A%20%20%20%20print(f%22Optimal%20Threshold%3A%20%7Boptimal_threshold%3A.2f%7D%22)%0A%20%20%20%20print(f%22%20%20Precision%3A%20%7Bthreshold_metrics%5B'precision'%5D%3A.3f%7D%22)%0A%20%20%20%20print(f%22%20%20Recall%3A%20%7Bthreshold_metrics%5B'recall'%5D%3A.3f%7D%22)%0A%20%20%20%20print(f%22%20%20F1%3A%20%7Bthreshold_metrics%5B'f1'%5D%3A.3f%7D%22)%0A%0A%20%20%20%20%23%20Precision-Recall%20curve%0A%20%20%20%20from%20sklearn.metrics%20import%20precision_recall_curve%0A%20%20%20%20precisions%2C%20recalls%2C%20thresholds%20%3D%20precision_recall_curve(y_test%2C%20y_proba)%0A%0A%20%20%20%20fig_pr%20%3D%20px.line(%0A%20%20%20%20%20%20%20%20x%3Drecalls%2C%20y%3Dprecisions%2C%0A%20%20%20%20%20%20%20%20labels%3D%7B%22x%22%3A%20%22Recall%22%2C%20%22y%22%3A%20%22Precision%22%7D%2C%0A%20%20%20%20%20%20%20%20title%3D%22Precision-Recall%20Curve%22%0A%20%20%20%20)%0A%20%20%20%20fig_pr.add_vline(x%3Dthreshold_metrics%5B%22recall%22%5D%2C%20line_dash%3D%22dash%22%2C%20line_color%3D%22red%22)%0A%20%20%20%20fig_pr%0A%20%20%20%20return%20(optimal_threshold%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%2011.%20Business%20Impact%20Analysis%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20X_test%2C%0A%20%20%20%20calculate_business_impact%2C%0A%20%20%20%20df_test%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20model%2C%0A%20%20%20%20optimal_threshold%2C%0A%20%20%20%20y_test%2C%0A)%3A%0A%20%20%20%20%23%20Calculate%20business%20impact%20of%20model%20predictions%0A%20%20%20%20y_proba_impact%20%3D%20model.predict_proba(X_test)%5B%3A%2C%201%5D%0A%0A%20%20%20%20%23%20Get%20LTV%20values%20from%20test%20data%0A%20%20%20%20ltv_values%20%3D%20df_test%5B%22estimated_ltv%22%5D%20if%20%22estimated_ltv%22%20in%20df_test.columns%20else%20df_test.get(%22monthly_charges%22%2C%20500)%20*%2012%0A%0A%20%20%20%20business_impact%20%3D%20calculate_business_impact(%0A%20%20%20%20%20%20%20%20y_true%3Dy_test%2C%0A%20%20%20%20%20%20%20%20y_proba%3Dy_proba_impact%2C%0A%20%20%20%20%20%20%20%20ltv_values%3Dltv_values%2C%0A%20%20%20%20%20%20%20%20intervention_cost%3D50.0%2C%20%20%23%20Cost%20per%20intervention%0A%20%20%20%20%20%20%20%20save_rate%3D0.40%2C%20%20%23%20Expected%2040%25%20save%20rate%0A%20%20%20%20%20%20%20%20threshold%3Doptimal_threshold%0A%20%20%20%20)%0A%0A%20%20%20%20impact_md%20%3D%20f%22%22%22%0A%20%20%20%20%23%23%23%20Business%20Impact%20Summary%0A%0A%20%20%20%20%7C%20Metric%20%7C%20Value%20%7C%0A%20%20%20%20%7C--------%7C-------%7C%0A%20%20%20%20%7C%20**True%20Positives**%20(Churners%20Caught)%20%7C%20%7Bbusiness_impact%5B'true_positives'%5D%3A%2C%7D%20%7C%0A%20%20%20%20%7C%20**False%20Positives**%20(Unnecessary%20Interventions)%20%7C%20%7Bbusiness_impact%5B'false_positives'%5D%3A%2C%7D%20%7C%0A%20%20%20%20%7C%20**False%20Negatives**%20(Churners%20Missed)%20%7C%20%7Bbusiness_impact%5B'false_negatives'%5D%3A%2C%7D%20%7C%0A%20%20%20%20%7C%20**Total%20Interventions**%20%7C%20%7Bbusiness_impact%5B'total_interventions'%5D%3A%2C%7D%20%7C%0A%20%20%20%20%7C%20**Intervention%20Cost**%20%7C%20%24%7Bbusiness_impact%5B'intervention_cost'%5D%3A%2C.0f%7D%20%7C%0A%20%20%20%20%7C%20**Expected%20Revenue%20Saved**%20%7C%20%24%7Bbusiness_impact%5B'expected_saved_revenue'%5D%3A%2C.0f%7D%20%7C%0A%20%20%20%20%7C%20**Lost%20Revenue**%20(Missed%20Churners)%20%7C%20%24%7Bbusiness_impact%5B'lost_revenue'%5D%3A%2C.0f%7D%20%7C%0A%20%20%20%20%7C%20**Net%20Benefit**%20%7C%20%24%7Bbusiness_impact%5B'net_benefit'%5D%3A%2C.0f%7D%20%7C%0A%20%20%20%20%7C%20**ROI**%20%7C%20%7Bbusiness_impact%5B'roi'%5D%3A.1f%7Dx%20%7C%0A%0A%20%20%20%20%23%23%23%20Key%20Insight%0A%0A%20%20%20%20For%20every%20%241%20spent%20on%20interventions%2C%20we%20expect%20to%20save%20**%24%7Bbusiness_impact%5B'roi'%5D%3A.2f%7D**%20in%20revenue.%0A%20%20%20%20%22%22%22%0A%0A%20%20%20%20mo.md(impact_md)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%2012.%20Save%20Model%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(PROJECT_ROOT%2C%20X_train%2C%20model)%3A%0A%20%20%20%20import%20joblib%0A%0A%20%20%20%20%23%20Save%20model%20using%20absolute%20paths%0A%20%20%20%20model_path%20%3D%20PROJECT_ROOT%20%2F%20%22outputs%22%20%2F%20%22models%22%20%2F%20%22churn_model_v1.joblib%22%0A%20%20%20%20model_path.parent.mkdir(parents%3DTrue%2C%20exist_ok%3DTrue)%0A%0A%20%20%20%20joblib.dump(model%2C%20model_path)%0A%0A%20%20%20%20%23%20Save%20feature%20columns%0A%20%20%20%20feature_path%20%3D%20model_path.with_suffix(%22.features.txt%22)%0A%20%20%20%20with%20open(feature_path%2C%20%22w%22)%20as%20f%3A%0A%20%20%20%20%20%20%20%20f.write(%22%5Cn%22.join(X_train.columns.tolist()))%0A%0A%20%20%20%20print(f%22Model%20saved%20to%20%7Bmodel_path%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%20Summary%0A%0A%20%20%20%20**Model%20trained%20and%20evaluated%20successfully!**%0A%0A%20%20%20%20%23%23%23%20Key%20Findings%0A%0A%20%20%20%20-%20%E2%9C%85%20Model%20achieves%20target%20AUC-PR%20and%20Precision%4010%25%20on%20validation%20set%0A%20%20%20%20-%20%F0%9F%93%8A%20Top%20drivers%3A%20engagement%20velocity%2C%20recency%2C%20support%20signals%0A%20%20%20%20-%20%F0%9F%91%A5%20Cohort-specific%20performance%20varies%20-%20new%20users%20need%20different%20approach%0A%20%20%20%20-%20%F0%9F%92%B0%20Enterprise%20accounts%20show%20higher%20precision%20(LTV-weighted%20training%20works!)%0A%20%20%20%20-%20%F0%9F%8E%AF%20SHAP-to-intervention%20mapping%20provides%20actionable%20recommendations%0A%0A%20%20%20%20%23%23%23%20Business%20Impact%0A%0A%20%20%20%20-%20Positive%20ROI%20demonstrated%20with%20intervention%20cost%2Fbenefit%20analysis%0A%20%20%20%20-%20Clear%20prioritization%20framework%20for%20Customer%20Success%20team%0A%20%20%20%20-%20Capacity-aware%20threshold%20selection%20for%20operational%20efficiency%0A%0A%20%20%20%20%23%23%23%20Next%20Steps%0A%0A%20%20%20%201.%20Deploy%20to%20Fabric%20MLflow%20model%20registry%0A%20%20%20%202.%20Integrate%20with%20CS%20platform%20for%20automated%20alerts%0A%20%20%20%203.%20A%2FB%20test%20intervention%20strategies%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">6ab1193edcbd17e0f2a0d93942c50d3d</marimo-code-hash>
</body>
</html>
